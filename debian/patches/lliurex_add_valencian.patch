From: =?utf-8?b?Ikpvc8OpIEwuIFJlZHJlam8gUm9kcsOtZ3VleiI=?=
 <jredrejo@debian.org>
Date: Thu, 11 Oct 2018 12:52:28 +0200
Subject: lliurex_add_valencian

===================================================================
---
 src/core/edu/xtec/jclic/media/EventSounds.java | 14 +++++++++-----
 src/core/edu/xtec/util/Messages.java           | 14 +++++++++++++-
 2 files changed, 22 insertions(+), 6 deletions(-)

--- a/src/core/edu/xtec/jclic/media/EventSounds.java
+++ b/src/core/edu/xtec/jclic/media/EventSounds.java
@@ -210,11 +210,15 @@
   }
 
   public void close() {
-    for (int i = 0; i < NUM_EVENTS; i++)
-      if (elements[i] != null) {
-        elements[i].close();
-        elements[i] = null;
-      }
+	try
+	{
+	    for(int i=0; i<NUM_EVENTS; i++)
+	        if(elements[i]!=null){
+	            elements[i].close();
+	            elements[i]=null;
+	        }
+	} catch(Exception ex) {
+	}
     parent = null;
   }
 
--- a/src/core/edu/xtec/util/Messages.java
+++ b/src/core/edu/xtec/util/Messages.java
@@ -115,7 +115,13 @@
             JOptionPane.OK_CANCEL_OPTION);
         pane.setSelectionValues(getDescriptiveLanguageCodes(null));
         pane.setWantsInput(true);
-        String initialSelection = getDescriptiveLanguageCode(Locale.getDefault().getLanguage());
+//        String initialSelection = getDescriptiveLanguageCode(Locale.getDefault().getLanguage());
+        String systemlanguage=Locale.getDefault().getLanguage();
+        if (System.getenv("LANG").contains("valenci"))
+        {
+            systemlanguage="val";
+        }
+        String initialSelection=getDescriptiveLanguageCode(systemlanguage);
         pane.setInitialSelectionValue(initialSelection);
         showDlg((Component) options.get(Options.MAIN_PARENT_COMPONENT), pane, "Language selecion");
         String sel = (String) pane.getInputValue();
@@ -147,6 +153,14 @@
 
   public void setLocale(String language, String country, String variant) {
     Locale l;
+    if (language != null) {
+		if (language.contains("val"))
+		{
+			language="ca";
+			country="ES";
+			variant="valencia";
+		}
+	}
     if (country == null) {
       country = "";
     }
@@ -677,6 +691,7 @@
   static {
     ISO_639_2_CODES.put("ast", "asturianu");
     ISO_639_2_CODES.put("vec", "vèneto");
+    ISO_639_2_CODES.put("val", "valencià");
   }
 
   public static String getDescriptiveLanguageCode(String languageCode) {
