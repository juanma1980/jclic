From: =?utf-8?b?Ikpvc8OpIEwuIFJlZHJlam8gUm9kcsOtZ3VleiI=?=
 <jredrejo@debian.org>
Date: Thu, 11 Oct 2018 12:52:28 +0200
Subject: lliurex_add_valencian

===================================================================
---
 src/core/edu/xtec/jclic/media/EventSounds.java | 14 +++++++++-----
 src/core/edu/xtec/util/Messages.java           | 14 +++++++++++++-
 2 files changed, 22 insertions(+), 6 deletions(-)

diff --git a/src/core/edu/xtec/jclic/media/EventSounds.java b/src/core/edu/xtec/jclic/media/EventSounds.java
index 88c95b1..5e1accf 100644
--- a/src/core/edu/xtec/jclic/media/EventSounds.java
+++ b/src/core/edu/xtec/jclic/media/EventSounds.java
@@ -210,11 +210,15 @@ public class EventSounds extends Object implements Domable, Cloneable {
   }
 
   public void close() {
-    for (int i = 0; i < NUM_EVENTS; i++)
-      if (elements[i] != null) {
-        elements[i].close();
-        elements[i] = null;
-      }
+	try
+	{
+	    for(int i=0; i<NUM_EVENTS; i++)
+	        if(elements[i]!=null){
+	            elements[i].close();
+	            elements[i]=null;
+	        }
+	} catch(Exception ex) {
+	}
     parent = null;
   }
 
diff --git a/src/core/edu/xtec/util/Messages.java b/src/core/edu/xtec/util/Messages.java
index 58988f2..0d2ff44 100644
--- a/src/core/edu/xtec/util/Messages.java
+++ b/src/core/edu/xtec/util/Messages.java
@@ -115,7 +115,18 @@ public class Messages {
             JOptionPane.OK_CANCEL_OPTION);
         pane.setSelectionValues(getDescriptiveLanguageCodes(null));
         pane.setWantsInput(true);
-        String initialSelection = getDescriptiveLanguageCode(Locale.getDefault().getLanguage());
+//        String initialSelection = getDescriptiveLanguageCode(Locale.getDefault().getLanguage());
+        String systemlanguage=Locale.getDefault().getLanguage();
+        if (System.getenv("LANG").contains("valenci"))
+        {
+            System.out.println(" [ Valencian ] ");
+            systemlanguage="val";
+        }
+        else
+        {
+            System.out.println(" [ LANG ] ");
+        }
+        String initialSelection=getDescriptiveLanguageCode(systemlanguage);
         pane.setInitialSelectionValue(initialSelection);
         showDlg((Component) options.get(Options.MAIN_PARENT_COMPONENT), pane, "Language selecion");
         String sel = (String) pane.getInputValue();
@@ -677,6 +688,7 @@ public class Messages {
   static {
     ISO_639_2_CODES.put("ast", "asturianu");
     ISO_639_2_CODES.put("vec", "vèneto");
+    ISO_639_2_CODES.put("val", "valencià");
   }
 
   public static String getDescriptiveLanguageCode(String languageCode) {
